# P2P

블록체인에만 있는 개념은 아니지만 블록체인에서 쓰이기 때문에 잘 알아야한다.
어려운 스킬적으로 보일 수 있지만 그렇지 않다.

내가 클라이언트이자 서버가 된다는 것을 이해해야한다.

p2p 네트워크의 개념은
하나의 프로그램(코드들)을 하나의 프로세스(실행)로 올려서 client와 server을 구축하는 것이다.
->하나의 프로그램(코드)에서 클라이언트측 코드와 서버측 코드를 작성한다.
-> front단에서 사용했던 client측 소켓코드와 back단에서 사용했던 server측 소켓 코드가 한 파일에 같이 있다는 것을 의미한다.

A 컴퓨터에서 B 컴퓨터로 데이터를 전달하기 위해서 가장 기본적인 형태를 보면
기본적으로 데이터를 컴퓨터가 이해할 수 있는 언어로 변환한 후 이를 전기신호로 전달을 한다음에 이를 다시 변환해서 보이게 한다.

컴퓨터에서 데이터를 전달하는 과정(네트워크)는 무조건 string 형태로 전달이 된다.
소켓IO같이 객체를 전달했는데, 객체가 왔다는 것은 없다. string으로 변환한 뒤 다시 파싱하는 과정을 내부적으로 진행했을 것이다.

# P2P 통신

`net` 4계층, `ws` 7계층
OSI 7계층 기준으로 7계층에서 1계층으로 내려갈수록 컴퓨터가 읽기 쉽고, 사람이 읽기 어려운 언어로 되고, 반대로 1계층에서 7계층으로 올라갈수록 컴퓨터가 읽기 어렵지만 사람이 읽기 쉬운 언어가 된다.

## server/p2p.ts

네트워크를 구성할 때 서버측이 작성이 되면서 대기 상태가 되어 있어야한다.

```ts
class P2PNetwork {
    listne(port: number) {
        const server = net.createServer((socket: Socket) => {
            console.log(socket)
        })
        console.log("p2p server start")
        server.listen(port)
    }
}
```

console.log(socket)은 클라이언트측에서 답장이 오는 3way핸드쉐이크에서 마지막단계에서 커넥션이 맺어졌을 때 작동을 한다.

일반적인 네트워크를 구성할 때는 server측 코드를 작성후에 다른 파일에서 client측 코드를 작성했지만
p2p네트워크에서는 listen 밑에 client측 코드도 작성되어야한다.

```ts
class P2PNetwork {
    listen() {}
    connet() {}
}
```

파일은 하나만 쓰지만, 어떤 것은 클라이언트, 어떤 것은 서버측 코드를 작성해야한다.
